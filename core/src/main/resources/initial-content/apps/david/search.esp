<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
<title>David Mini CMS</title>
<%
load("header.esp");
%>
</head>
<body>
<div id="lCenter">
	<div id="desktop">
		<%
		load("menu.esp");
		%>
		<div id="contentPanel" class="centralPanel">
			<h3>Search panel</h3>
			<div>
                                <%
                                if((request.getParameter('qtitle'))||(request.getParameter('qtext'))||(request.getParameter('qtag'))) {
                                    var queryManager = currentNode.getSession().getWorkspace().getQueryManager();
                                    if (request.getParameter('qtitle'))
                                        var query = queryManager.createQuery("/jcr:root/content/david/*/*/*/element(*, nt:unstructured)[jcr:like(@title, '%"+request.getParameter("qtitle")+"%')] order by @created descending", "xpath");
                                    else if (request.getParameter('qtext'))
                                        var query = queryManager.createQuery("/jcr:root/content/david/*/*/*/element(*, nt:unstructured)[jcr:like(@text, '%"+request.getParameter("qtext")+"%')] order by @created descending", "xpath");
                                    else {
                                        var query = queryManager.createQuery("/jcr:root/content/tags/element(*, nt:unstructured)[jcr:like(@name, '%"+request.getParameter("qtag")+"%')] order by @created descending", "xpath");
                                    }
                                    var result = query.execute().getNodes();
                                    while(result.hasNext()) {
                                        post = result.nextNode();
                                        %>
                                        <h3><a href="<%= post.getPath() %>.view"><%=post.title%></a></h3>
                                    <%}
                                } else {%>

                                    <br/>
                                    <br/>
                                    Search by title:<br/><br/>
                                    <form method="GET" action="/content/david.search">
                                    <input type="text" name="qtitle" size="20" value=""/>
                                    <input type="submit" id="submit" name="submit" value="Search"/>
                                    </form>
                                    <br/><br/>
                                    <br/>
                                    <br/>
                                    Search by text content:<br/><br/>
                                    <form method="GET" action="/content/david.search">
                                    <input type="text" name="qtext" size="20" value=""/>
                                    <input type="submit" id="submit" name="submit" value="Search"/>
                                    </form>
                                    <br/><br/>
                                    <br/>
                                    <br/>
                                    Search by tag content:<br/><br/>
                                    <form method="GET" action="/content/david.search">
                                    <input type="text" name="qtag" size="20" value=""/>
                                    <input type="submit" id="submit" name="submit" value="Search"/>
                                    </form>
                                    <br/><br/>
                                <%}%>

                        </div>
		    </div>
	</div>
</div>

</body>
</html>
